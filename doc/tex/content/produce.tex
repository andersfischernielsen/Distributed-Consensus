% !TeX root = ../DCR-Consensus.tex
\section{Produce}
\subsection{Goal} % Hvad er problemet
The goal of the algortithm is, given a DCR graph, to fetch and merge the histories of each event in the graph into one history, such that the resulting history is partially ordered in accordance to the ruleset described in \autoref{chap:domainanalysis}. 

%Correcness should be based on:
%\begin{itemize}
%    \item How many nodes' history gets fetched in the workflow (higher is better).
%    \item How rendundant the data is (higher redundancy is better).
%    \item How well it handles cycles in the graph
%\end{itemize}

\subsection{Implementation} % hvordan løses det
The implementation of the algorithm starts at a single event in the workflow and is called recursively on the reachable events in the workflow. A reachable event in the workflow constitutes any event that has a relation from the current event in scope. \todo[inline]{Udvid beskrivelse til at inkludere løsning hvis event peger på nuværende event. Dette event er p.t. ikke "synligt".}


\begin{lstlisting}[breaklines=true]
 1. History is requested by `X` with `request trace` `T` and history ID: `HID`
    1. If (Lookup history for `HID`) is not empty
        - Return lookup history for `HID`
    - Add all relations to `wait for`
    - If `wait for` is empty
        - Create history
        - Return
    - For each node `n` in `T`
        - if `n` is in `wait for`
            - remove `n` from `wait for`
    - Create `T'` by appending own ID to `T`
    - If `wait for` is empty
        - Cyclic case: Return empty set -> maybe return local set
    - Ask all nodes in `wait for` for their history with `T'`
    - Stitch own history with answers
    - Return "new" history
\end{lstlisting}

\subsection{Discussion} % bliver problemet løst
\subsection{Performance} % hvor godt løses det