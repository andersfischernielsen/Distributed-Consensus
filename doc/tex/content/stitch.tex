% !TeX root = ../DCR-Consensus.tex
\section{Stitch}
\subsection{Goal} % Hvad er problemet
The goal of the algortithm is, given a collection of partially ordered histories, to merge the histories into one history which includes all of the logs of the histories, such that the resulting history remains partially ordered in accordance to the ruleset described in \ref{chap:domainanalysis}.

%Logs should not be understood as executions only but all the different kinds of logs, see log description.
%A partially ordered graph should not contain cycles.

\subsection{Implementation} % hvordan løses det
To solve the problem a datastructure which represents the partial ordered history has to be introduced. Such a datastructure requires the following functions:

\begin{algorithmic}
\Function{Add} {graph node}
	\If {EXISTS graph node}
	    \State union matching node edge sets.
	\Else
	    \State Add node to list of nodes.
	\EndIf
\EndFunction

\State\State

\Function{Add}{graph edge}
	\State add edge to source node.
\EndFunction

\State\State

\Function{stitch}{localgraph graphlist}
\ForAll{graph in graphlist}
	\ForAll{node in graph}
		\State\Call{Add}{localgraph node}
	\EndFor
\EndFor
\ForAll{node1 in localgraph}
	\ForAll{node2 in localgraph}
		\If{node1 and node2 does not have an edge}
			\If{node1 and node2 has a happen before relation}
				\State create edge from node1 to node2
			\EndIf
		\EndIf
	\EndFor
\EndFor
\State cyclecheck
\EndFunction
\end{algorithmic}

\subsection{Discussion} % bliver problemet løst
\subsection{Performance} % hvor godt løses det

