% !TeX root = ../DistributedConsensus.tex
\chapter{Consensus of History in Distributed DCR Graphs}
\label{chap:consensusindcr}
	This chapter defines the validation of local and global histories across multiple events. It also defines how to determine when a history can be produced, and, if possible, which events have inconsistent history data.
	 

	\todo[inline]{Tilføj rigtig definition.}
	
	\section{Validating histories}
	In order to validate a given history, a valid history is defined as follows
	
		\begin{definition}
			A \textit{\textbf{Valid History}} is a history, H, for which it applies that all actions happen according to the rules of the DCR graph, abiding serial equivalence and being in a strict partial order. 
		\end{definition}
	
	\subsection{History graph and DCR graph rules}
	\todo{maybe this header is not neccesary? as well as the paragraph}
	Several rules must be adhered to for a history to be valid. These rules are both specific to the history graph and to DCR graphs in general. 
		
	\subsubsection{DCR Rules}
	A given execution must abide the rules of the DCR graph it is part of. That includes the following:
	
	\newpar \textbf{Valid relations}: A given history for an event, $e1$, must only contain actions which represents relations to another event, $e2$, where there exists such a relation in the DCR graph definition and vice versa. 
	
	\newpar \textbf{Complete executions}: A given event, $e1$ must affect all of its outgoing relations when executing. Furthermore every event that $e1$ has a relation to must have a \texttt{By} relation in its history after $e1$ has executed.
	
	\newpar \textbf{Executions in Valid States}: A given history for an event, $e1$, must only have executions where the state is included, and the event's conditions are either executed or excluded.
	
	\subsubsection{Serial Equivelent Rules}
	A given execution must abide the rules of serially equivelent executions. That includes the following:
	
	\newpar \textbf{Non-disrupted Executions}: A given event, $e1$ must affect all of its outgoing relations when executing without having any other executions start or affect the event.
	
	\subsubsection{History Graph Rules / Strict Partial Ordering / Lamport Logical Clocks}
	\textbf{Cycles:} A given history graph must not contain any cycles, since cycles in the history graph would imply that an action, $a1$, has occurred before another action, $a2$, but $a2$ has also occurred before $a1$. This is not possible in any execution, and a given history with cycles will therefore be invalid.
	
	\newpar \textbf{Mismatches in typestamps:} A given history graph must not contain any actions that have relations to actions with an invalid timestamp. This would imply that either an executing event has tampered with its outgoing action history or that an event affected by an execution has tampered with its ingoing action history. 
	
	\todo[inline]{Uddyb regler og tilføj evt. en figur der viser mismatches mellem timestamps. }
	
	

	\todo[inline]{Uddyb regler og tilføj evt. en figur der viser invalid DCR historik ift. relations der ikke eksisterer. }