% !TeX root = DistributedConsensus.tex
\chapter{Connecting Histories} % MÃ¥ske bedre navn. Dette er lidt for Nokia.
\label{chap:connecting-histories}
	% Happens before, Transitive Closure, Transitive Reduction, Collapsing, Filtering, No cycles in history
	\section{Creating Distributed  History} 
	In order to build a history for the events reachable in the system, local histories for connected events have to be connected somehow in order to enable finding a global history. 
	
	%Happens-before
	Using the concept of happens-before relations helps determining what events (or executions of events) have happened before others. 
	
	The individual actions that have happened on an event will have happens-before relations between them, according to the rule that if $A$ and $B$ occur on the same process, then $A \rightarrow B$ if $A$ happened before $B$ on event $E$. 
	Futhermore edges can be created between actions on two different events, if $A$ is registered as sent on event $a$ and is registered as received on event $b$.
	
	The concepts of transitivity, irreflexivity and antisymmetry also apply to the happens-before relation. That is if $A \rightarrow B$ and $B \rightarrow C$, then $A \rightarrow C$ (transitivity), $A \not\rightarrow A$ (irreflexivity) and if $A \not\equiv B$ and $A \rightarrow B$ then $B \not\rightarrow A$ (antisymmetry).
	
	Using the representation of history detailed in \ref{chap:representing-a-history} it is possible to create a graph of happens-before relations.
	
	% Transitive closure
	In order to build an order of execution, edges between all executions in the history graph must exist. The transitive closure of the history graph has this property and it is therefore necessary to find this closure. 
	
	In order to not create redundant edges in the history graph, it is possible to only find the first edge from a given action to its neighbors and then repeat this procedure for every neighbor, since every action of the given type will still then be reachable. %TODO: Proof.
	If these edges are not found, execution actions will not be connected and therefore not reachable, and finding an order of execution would be impossible. % TODO: Really impossible?
	
	% TODO: Transitive reduction
	Redudant edges exist in a given history graph. These edges do not give any extra information, since the reachability to an action is the same. In prder to give a usable history, these redundant edges should be removed. 
	A subgraph of a given graph that has the same reachability but as few edges as possible, a minimum equivalent graph, is therefore desired. Finding this is possible by doing transitive reduction on the original graph, which then results in the minimum equivalent graph. 
	Therefore, if there is a path from an edge $x$ to an edge $y$ in graph G, there must also be a path from $x$ to $y$ in the transitive reduction of $G$, and vice versa. 
	
	% TODO: Collapsing
	
	It is necessary to filter actions depending on their type. If a history describing an order of execution is desired, then every action except for \texttt{ExecutionStart} and \texttt{ExecutionEnd} must be removed from the history graph. 
	
	% TODO: No cycles
	\section{Connecting Histories using Algorithms} % Giv bedre navn
	The implementation of determining happens-before relations works by looking at every node in the history graph, creating an edge between nodes of the given type wishing to be found, and adding the node the edge is going to to the list of nodes to check. The algorithm is implemented in such a way that the iteration through the history graph is a Breath First Search. 
	
	\section{Correctness of the Implementation} % Giv bedre navn
	